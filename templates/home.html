<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Age Keyserver</title>
	<link rel="stylesheet" href="/static/style.css">
	<script src="https://js.hcaptcha.com/1/api.js" async defer></script>
</head>
<body>
	<h1>Age Keyserver</h1>

	<p>A simple public keyserver for <a href="https://age-encryption.org" target="_blank">age</a> encryption.</p>

	<div class="section">
		<h2>Login to manage your key</h2>
		<p>Enter your email address to receive a login link:</p>
		<form action="/login" method="POST">
			<label for="email">Email address</label>
			<input type="email" id="email" name="email" required placeholder="you@example.com">

			<div class="h-captcha" data-sitekey="10000000-ffff-ffff-ffff-000000000001"></div>

			<button type="submit">Send login link</button>
		</form>
	</div>

	<div class="section">
		<h2>Look up a public key</h2>
		<p>Enter an email address to retrieve the associated age public key:</p>
		<form id="lookup-form">
			<label for="lookup-email">Email address</label>
			<input type="email" id="lookup-email" name="email" required placeholder="someone@example.com">
			<button type="submit">Look up</button>
		</form>
		<div id="lookup-result"></div>
	</div>

	<div class="footer">
		<p>Learn more about <a href="https://age-encryption.org" target="_blank">age encryption</a></p>
	</div>

	<script>
		document.getElementById('lookup-form').addEventListener('submit', async (e) => {
			e.preventDefault();
			const email = document.getElementById('lookup-email').value;
			const resultDiv = document.getElementById('lookup-result');

			try {
				const resp = await fetch('/lookup?email=' + encodeURIComponent(email));
				if (resp.ok) {
					const data = await resp.json();
					resultDiv.innerHTML = '<p style="margin-top: 1rem;"><strong>Public key for ' + email + ':</strong></p><p class="code">' + data.pubkey + '</p>';
				} else {
					resultDiv.innerHTML = '<p style="margin-top: 1rem;" class="error">No key found for this email address.</p>';
				}
			} catch (err) {
				resultDiv.innerHTML = '<p style="margin-top: 1rem;" class="error">Error looking up key.</p>';
			}
		});
	</script>
</body>
</html>
